<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>无延迟菜单</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
        }

        .wrap {
            position: relative;
            width: 250px;
        }

        ul {
            padding: 15px 0;
            list-style: none;
            background: #6c6669;
            color: #ffffff;
            border-right-width: 0;
        }

        li {
            display: block;
            height: 30px;
            line-height: 30px;
            padding-left: 12px;
            cursor: pointer;
            font-size: 14px;
            position: relative;
        }

        li .active {
            background: #999395;
        }

        li span:hover {
            color: #c81623;
        }

        .none {
            display: none;
        }

        #sub {
            width: 600px;
            position: absolute;
            border: 1px solid #f7f7f7;
            background: #f7f7f7;
            box-shadow: 2px 0 5px rgba(0, 0, 0, .3);
            left: 250px;
            top: 0;
            box-sizing: border-box;
            margin: 0;
            padding: 10px;
        }

        .sub_content a {
            font-size: 12px;
            color: #666;
            text-decoration: none;
        }

        .sub_content dd a {
            border-left: 1px solid #e0e0e0;
            padding: 0 10px;
            margin: 4px 0;
        }

        .sub_content dl {
            overflow: hidden;
        }

        .sub_content dt {
            float: left;
            width: 70px;
            font-weight: bold;
            clear: left;
            position: relative;
        }

        .sub_content dd {
            float: left;
            margin-left: 5px;
            border-top: 1px solid #eee;
            margin-bottom: 5px;
        }

        .sub_content dt i {
            width: 4px;
            height: 14px;
            font: 400 9px/14px Consolas;
            position: absolute;
            right: 5px;
            top: 5px;
        }
    </style>
</head>
<body>
<div id="menu" class="wrap">
    <ul>
        <li data-id="a">
            <span>家用电气</span>
        </li>
        <li data-id="b">
            <span>手机 / 运营商 / 数码</span>
        </li>
        <li data-id="c">
            <span>电脑办公</span>
        </li>
        <!--<li data-id="d">-->
            <!--<span>家居 / 家具 / 家装 / 厨具</span>-->
        <!--</li>-->
        <!--<li data-id="e">-->
            <!--<span>男装 / 女装 / 童装 / 内衣</span>-->
        <!--</li>-->
        <!--<li data-id="f">-->
            <!--<span>个护化妆 / 清洁用品 / 宠物</span>-->
        <!--</li>-->
        <!--<li data-id="g">-->
            <!--<span>鞋靴 / 箱包 / 珠宝 / 奢侈品</span>-->
        <!--</li>-->
        <!--<li data-id="h">-->
            <!--<span>运动 / 户外 / 钟表</span>-->
        <!--</li>-->
        <!--<li data-id="i">-->
            <!--<span>汽车 / 汽车用品</span>-->
        <!--</li>-->
        <!--<li data-id="j">-->
            <!--<span>女婴 / 玩具乐器</span>-->
        <!--</li>-->
        <!--<li data-id="k">-->
            <!--<span>食品 / 酒类 / 生鲜 / 特产</span>-->
        <!--</li>-->
        <!--<li data-id="l">-->
            <!--<span>医疗保健</span>-->
        <!--</li>-->
    </ul>
    <div id="sub" class="none">
        <div id="a" class="sub_content">
            <dl>
                <dt><a href="#">电视<i>&gt;</i></a></dt>
                <dd>
                    <a href="#">超薄电视</a>
                    <a href="#">全面屏电视</a>
                    <a href="#">智能电视</a>
                </dd>
            </dl>
            <dl>
                <dt><a href="#">空调<i>&gt;</i></a></dt>
                <dd>
                    <a href="#">空调挂机</a>
                    <a href="#">空调柜机</a>
                    <a href="#">精选推荐</a>
                </dd>
            </dl>
            <dl>
                <dt><a href="#">洗衣机<i>&gt;</i></a></dt>
                <dd>
                    <a href="#">滚筒洗衣机</a>
                    <a href="#">洗烘一体机</a>
                    <a href="#">波轮洗衣机</a>
                </dd>
            </dl>
            <dl>
                <dt><a href="#">冰箱<i>&gt;</i></a></dt>
                <dd>
                    <a href="#">多门</a>
                    <a href="#">对开门</a>
                    <a href="#">三门</a>
                </dd>
            </dl>
        </div>

        <div id="b" class="sub_content none">
            <dl>
                <dt><a href="#">电视1<i>&gt;</i></a></dt>
                <dd>
                    <a href="#">超薄电视1</a>
                    <a href="#">全面屏电视1</a>
                    <a href="#">智能电视1</a>
                </dd>
            </dl>
            <dl>
                <dt><a href="#">空调1<i>&gt;</i></a></dt>
                <dd>
                    <a href="#">空调挂机1</a>
                    <a href="#">空调柜机1</a>
                    <a href="#">精选推荐1</a>
                </dd>
            </dl>
            <dl>
                <dt><a href="#">洗衣机1<i>&gt;</i></a></dt>
                <dd>
                    <a href="#">滚筒洗衣机1</a>
                    <a href="#">洗烘一体机1</a>
                    <a href="#">波轮洗衣机1</a>
                </dd>
            </dl>
            <dl>
                <dt><a href="#">冰箱1<i>&gt;</i></a></dt>
                <dd>
                    <a href="#">多门1</a>
                    <a href="#">对开门1</a>
                    <a href="#">三门1</a>
                </dd>
            </dl>
        </div>
        <div id="c" class="sub_content none">
            <dl>
                <dt><a href="#">电视2<i>&gt;</i></a></dt>
                <dd>
                    <a href="#">超薄电视2</a>
                    <a href="#">全面屏电视2</a>
                    <a href="#">智能电视2</a>
                </dd>
            </dl>
            <dl>
                <dt><a href="#">空调2<i>&gt;</i></a></dt>
                <dd>
                    <a href="#">空调挂机2</a>
                    <a href="#">空调柜机2</a>
                    <a href="#">精选推荐2</a>
                </dd>
            </dl>
            <dl>
                <dt><a href="#">洗衣机2<i>&gt;</i></a></dt>
                <dd>
                    <a href="#">滚筒洗衣机2</a>
                    <a href="#">洗烘一体机2</a>
                    <a href="#">波轮洗衣机2</a>
                </dd>
            </dl>
            <dl>
                <dt><a href="#">冰箱2<i>&gt;</i></a></dt>
                <dd>
                    <a href="#">多门2</a>
                    <a href="#">对开门2</a>
                    <a href="#">三门2</a>
                </dd>
            </dl>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src="http://libs.baidu.com/jquery/1.10.2/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        var sub = $('#sub');
        var activeRow;
        var activeMenu;
        var timer;
        var mouseInSub = false;
        //判断符号相同
        function sameSign(a,b) {
            return (a ^ b) >= 0
        }

        function vector(a, b) {
            return {
                x: b.x - a.x,
                y: b.y - a.y
            }
        }

        function vectorProduct(v1, v2) {
            return v1.x * v2.y - v2.x * v1.y;
        }

        function isPointInTrangle(p, a, b, c) {
            var pa = vector(p, a);
            var pb = vector(p, b);
            var pc = vector(p, c);
            var t1 = vectorProduct(pa,pb);
            var t2 = vectorProduct(pa,pc);
            var t3 = vectorProduct(pc,pa);
            return sameSign(t1,t2)&&sameSign(t2,t3);
        }

        function needDelay(elem,leftCorner,currMousePos) {
            var offset = elem.offset();
            var topLeft = {
                x:offset.left,
                y:offset.top
            }

            var bottomLeft = {
                x:offset.left,
                y:offset.top + elem.height()
            }

            return isPointInTrangle(currMousePos,leftCorner,topLeft,bottomLeft)
        }



        sub.on('mouseenter', function () {
            mouseInSub = true;
        }).on('mouseleave', function () {
            mouseInSub = false;
        });

        var mouseTrack = [];

        var moveHandler = function (e) {
            mouseTrack.push({
                x: e.pageX,
                y: e.pageY
            })
            if (mouseTrack.length > 3) {
                mouseTrack.shift()
            }
        };

        $('#menu').on('mouseenter', function (e) {
            sub.removeClass('none');
            $(document).bind('mousemove', moveHandler);

        }).on('mouseleave', function (e) {
            sub.addClass('none');
            if (activeRow) {
                activeRow.removeClass('active');
                activeRow = null;
            }
            if (activeMenu) {
                activeMenu.addClass('none');
                activeMenu = null;
            }
            $(document).unbind('mousemove', moveHandler)
        }).on('mouseenter', 'li', function (e) {
            if (!activeRow) {
                activeRow = $(e.target).addClass('active');
                activeMenu = $('#' + activeRow.data('id'))
                activeMenu.removeClass('none');
                return;
            }

            if (timer) {
                clearTimeout(timer)
            }

            var currMousePos = mouseTrack[mouseTrack.length - 1]; //当前坐标
            var leftCorner = mouseTrack[mouseTrack.length - 2]; //上一个坐标
            var delay = needDelay(sub,leftCorner,currMousePos);
            if(delay){
                timer = setTimeout(function () {
                    if (mouseInSub) {
                        return;
                    }
                    activeRow.removeClass('active');
                    activeMenu.addClass('none');
                    activeRow = $(e.target)
                    activeRow.addClass('active');
                    activeMenu = $('#' + activeRow.data('id'))
                    activeMenu.removeClass('none');
                    timer = null;
                }, 300)
            }else{
                var prevActiveRow = activeRow;
                var prevActiveMenu = activeMenu;

                activeRow  = $(e.target)
                activeMenu = $('#'+activeRow.data('id'))
                prevActiveRow.removeClass('active');
                prevActiveMenu.addClass('none');

                activeRow.addClass('active');
                activeMenu.removeClass('none');
            }

        });
    })
</script>
</html>